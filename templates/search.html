{% extends "base.html" %}
{% block title %}Поиск анкет – Lovina{% endblock %}

{% block content %}
<h2 class="card-title">Поиск анкет</h2>
<p class="card-subtitle">
    В результат попадают только те, кто подходит по полу и не скрыл свою анкету.
</p>

<form method="post">
    <div class="form-group">
        <label class="form-label">Имя</label>
        <input class="form-input" name="name" value="{{ name_q }}">
    </div>

    <div class="form-group">
        <label class="form-label">Возраст</label>
        <input
            class="form-input"
            name="age"
            type="number"
            min="18"
            max="80"
            value="{{ age_q }}"
        >
    </div>

    <button type="submit" class="btn btn-primary">Искать</button>
</form>

<hr style="margin: 16px 0; border: none; border-top: 1px solid #ffe0ee;">

{% if profiles %}
    <ul class="profiles-list">
        {% for p in profiles %}
            <li class="profile-card">
                {% if p.photo_filename %}
                    <img class="profile-photo"
                         src="{{ url_for('static', filename='uploads/' ~ p.photo_filename) }}">
                {% else %}
                    <div class="profile-photo"></div>
                {% endif %}
                <div class="profile-info">
                    <div class="profile-info-name">{{ p.name }}</div>
                    <div class="profile-info-age">{{ p.age }} лет</div>
                    {% if p.about %}
                        <div class="profile-info-about">
                            {{ p.about }}
                        </div>
                    {% endif %}
                    
                    
                    <div class="profile-actions">
                        {% if p.user_id in liked_user_ids %}
                            <button class="btn btn-liked" disabled>
                                ❤️ Лайк
                            </button>
                        {% else %}
                            <form action="{{ url_for('like_profile', user_id=p.user_id) }}" method="post" style="display:inline;">
                                <button type="submit" class="btn btn-primary">
                                    ❤️ Лайк
                                </button>
                            </form>
                        {% endif %}
                    </div>
                </div>
            </li>
        {% endfor %}
    </ul>

    <div class="pagination">
        {% if page > 1 %}
            <a href="{{ url_for('search', page=page-1, name=name_q, age=age_q) }}">← Предыдущие</a>
        {% endif %}
        {% if has_next %}
            {% if page > 1 %} · {% endif %}
            <a href="{{ url_for('search', page=page+1, name=name_q, age=age_q) }}">Следующие →</a>
        {% endif %}
    </div>
{% else %}
    <p class="index-status">По вашему запросу анкет не найдено.</p>
{% endif %}

<style>
.profile-actions {
    margin-top: 12px;
    display: flex;
    gap: 8px;
}

.profile-actions .btn {
    padding: 6px 14px;
    font-size: 13px;
    border-radius: 16px;
}

.profile-actions .btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(255, 79, 139, 0.3);
}

.btn-liked {
    background: #cccccc !important;
    color: #666666 !important;
    border: 1px solid #bbbbbb !important;
    cursor: not-allowed !important;
    box-shadow: none !important;
}

.btn-liked:hover {
    transform: none !important;
    box-shadow: none !important;
}
</style>
{% endblock %}